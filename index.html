<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>async.lua</title>
    <link rel="stylesheet" href="ldoc.css" type="text/css" />
</head>
<body>


<aside id="sidebar" class="has-background-white-ter">
    <h1 class="title">async.lua</h1>
    <nav class="menu">
        <p class="menu-label">Modules</p>
        <ul class="menu-list">
            <li>
                <a class="is-active">async</a>
                <ul>
                    <li><a href="#toc">Table of contents</a></li>
                    <li><a href="#Functions">Functions</a></li>
                </ul>
            </li>
        </ul>
        <p class="menu-label">Source</p>
        <ul class="menu-list">
            <li><a href="source/async.lua.html">async.lua</a></li>
        </ul>
    </nav>
</aside>
<div id="content" class="content__wrapper">
    <section class="section section__module-description">
        <div class="container">
            <h1 class="title is-1">Module <em>async</em></h1>
            <h3 class="subtitle is-3">Utilities to work with asynchronous callback-style control flow.</h3>
            <div class="content">
                <p> All callbacks must adhere to the callback signature: <code>function(err, values...)</code>.
 The first parameter is the error value. It will be <code>nil</code> if no error ocurred, otherwise
 the error value depends on the function that the callback was passed to.
 If no error ocurred, an arbitrary number of return values may be received as second parameter and onward.</p>

<p> Depending on the particular implementation of a function that a callback is passed to, it may be possible to
 receive non-<code>nil</code> return values, even when an error ocurred. Using such return values should be considered undefined
 behavior, unless explicitly documented by the calling function.</p>
            </div>
            <div class="field is-grouped is-grouped-multiline">
                <div class="control">
                    <div class="tags are-medium has-addons">
                        <span class="is-dark tag">License</span>
                        <span class="tag">GPL v3.0</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="section section__module-summary">
        <div class="container">
            <h2 id="toc" class="title is-3">Table of contents</h2>
            <h3 class="title is-4"><a href="#Functions">Functions</a></h3>
            <table class="table is-fullwidth is-striped">
                <tbody>
                    <tr>
                        <td class="name"><a href="#once">once([fn])</a></td>
                        <td class="summary">Wraps a function such that it can only ever be called once.</td>
                    </tr>
                    <tr>
                        <td class="name"><a href="#wrap_sync">wrap_sync(fn)</a></td>
                        <td class="summary">Turns an asynchronous function into a blocking operation.</td>
                    </tr>
                    <tr>
                        <td class="name"><a href="#waterfall">waterfall(tasks, final_callback)</a></td>
                        <td class="summary">Executes a list of asynchronous functions in series.</td>
                    </tr>
                    <tr>
                        <td class="name"><a href="#all">all(tasks, final_callback)</a></td>
                        <td class="summary">Runs all tasks in parallel and collects the results.</td>
                    </tr>
                    <tr>
                        <td class="name"><a href="#dag">dag(tasks, final_callback)</a></td>
                        <td class="summary">Resolves a DAG (Directed Acyclic Graph) of asynchronous dependencies.</td>
                    </tr>
                    <tr>
                        <td class="name"><a href="#do_while">do_while(iteratee, test, final_callback)</a></td>
                        <td class="summary">Repeatedly calls <code>test</code> and <code>iteratee</code> until stopped.</td>
                    </tr>
                    <tr>
                        <td class="name"><a href="#callback">callback([object], fn, ...)</a></td>
                        <td class="summary">Wrap a function with arguments for use as callback.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <section class="section section--Functions">
        <div class="container">
            <h2 class="title is-2" id="Functions"><a href="#Functions">Functions</a></h2>
            <div class="section__content">
                <div id="once" class="box section__item">
                    <div class="block section__item__title">
                        <strong>once([fn])</strong>
                        <a class="source-ref" href="source/async.lua.html#30">line 30</a>
                    </div>

                    <div class="block content section__item__description">Wraps a function such that it can only ever be called once. </p>

<p> If the returned function is called multiple times, only the first call will result
 in the wrapped function being called. Subsequent calls will be ignored.
 If no function is given, a noop function will be used.</div>

                    <div class="block content section__item__params">
                        <h4 class="title is-6">Parameters:</h4>
                        <ul>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>fn</em></span>
                                    <span class="parameter__description">:&nbsp; The function to wrap.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                    <div class="control">
                                        <div class="tags">
                                            <span class="tag">optional</span>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <div class="block content section__item__returns">
                        <h4 class="title is-6">Returns:</h4>
                        <ul>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>The wrapped function or a noop.</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">function</span></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="wrap_sync" class="box section__item">
                    <div class="block section__item__title">
                        <strong>wrap_sync(fn)</strong>
                        <a class="source-ref" href="source/async.lua.html#56">line 56</a>
                    </div>

                    <div class="block content section__item__description">Turns an asynchronous function into a blocking operation. </p>

<p> Using coroutines, this runs a callback-style asynchronous function and blocks until it completes.
 The function to be wrapped may only accept a single parameter: a callback function.
 Return values passed to this callback will be returned as regular values by <code>wrap_sync</code>.</p>

<p> Panics that happened inside the asynchronous function will be captured and re-thrown.</div>

                    <div class="block content section__item__params">
                        <h4 class="title is-6">Parameters:</h4>
                        <ul>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>fn</em></span>
                                    <span class="parameter__description">:&nbsp; An asynchronous function: <code>function(cb)</code></span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <div class="block content section__item__returns">
                        <h4 class="title is-6">Returns:</h4>
                        <ul>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>Any return values as passed by the wrapped function</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">any</span></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="waterfall" class="box section__item">
                    <div class="block section__item__title">
                        <strong>waterfall(tasks, final_callback)</strong>
                        <a class="source-ref" href="source/async.lua.html#90">line 90</a>
                        <span class="tag">async</span>
                    </div>

                    <div class="block content section__item__description">Executes a list of asynchronous functions in series. </p>

<p> <code>waterfall</code> accepts an arbitrary list of asynchronous functions (tasks) and calls them in series.
 Each function waits for the previous one to finish and will be given the previous function&rsquo;s return values.</p>

<p> If an error occurs in any task, execution is stopped immediately, and the final callback is called
 with the error value.
 If all tasks complete successfully, the final callback will be called with the return values of the last
 task in the list.</p>

<p> All tasks must adhere to the callback signature: <code>function(err, ...)</code>.</div>

                    <div class="block content section__item__params">
                        <h4 class="title is-6">Parameters:</h4>
                        <ul>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>tasks</em></span>
                                    <span class="parameter__description">:&nbsp; The asynchronous tasks to execute in series.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>final_callback</em></span>
                                    <span class="parameter__description">:&nbsp; Called when all tasks have finished.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <div class="block content section__item__returns">
                        <h4 class="title is-6">Callback parameters:</h4>
                        <ul>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>The error returned by a failing task.</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">any</span></span>
                                </div>
                            </li>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>Values as returned by the last task.</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">any</span></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="all" class="box section__item">
                    <div class="block section__item__title">
                        <strong>all(tasks, final_callback)</strong>
                        <a class="source-ref" href="source/async.lua.html#138">line 138</a>
                        <span class="tag">async</span>
                    </div>

                    <div class="block content section__item__description">Runs all tasks in parallel and collects the results. </p>

<p> If any task produces an error, <code>final_callback</code> will be called immediately
 and remaining tasks will not be tracked.</div>

                    <div class="block content section__item__params">
                        <h4 class="title is-6">Parameters:</h4>
                        <ul>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>tasks</em></span>
                                    <span class="parameter__description">:&nbsp; A list of asynchronous functions. They will be given a
  callback parameter: <code>function(err, ...)</code>.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>final_callback</em></span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                </div>
                <div id="dag" class="box section__item">
                    <div class="block section__item__title">
                        <strong>dag(tasks, final_callback)</strong>
                        <a class="source-ref" href="source/async.lua.html#219">line 219</a>
                        <span class="tag">async</span>
                    </div>

                    <div class="block content section__item__description">Resolves a DAG (Directed Acyclic Graph) of asynchronous dependencies. </p>

<p> The task list is a key-value map, where the key defines the task name and the value the is the task definition.
 A task definition consists of a a list of dependencies (which may be empty) and an asynchronous
 function.
 Any task name may be used as dependency for any other task, as long as no loops are created.
 A task&rsquo;s function will be called once all of its dependencies have become available and will be passed a <code>results</code>
 table that contains the values returned by all tasks so far.</p>

<p> If any tasks passes an error to its callback, execution and tracking for all other tasks stops and <code>final_callback</code>
 is called with that error value. Otherwise, <code>final_callback</code> will be called once all tasks have completed, with the
 results of all tasks.</p>

<p> The <code>results</code> table uses the task name as key and provides a <code>table.pack</code>ed list of task results as value.</div>

                    <div class="block content section__item__params">
                        <h4 class="title is-6">Parameters:</h4>
                        <ul>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>tasks</em></span>
                                    <span class="parameter__description">:&nbsp; A map of asynchronous tasks.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>final_callback</em></span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <div class="block content section__item__returns">
                        <h4 class="title is-6">Callback parameters:</h4>
                        <ul>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>Any error from a failing task.</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">any</span></span>
                                </div>
                            </li>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>Results of all resolved tasks.</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="block content section__item__usage">
                        <h4 class="title is-6">Usage:</h4>
                            <pre class="code-block code-block--lua">async.dag(
    {
        get_data = { <span class="keyword">function</span>(cb)
            <span class="keyword">local</span> f = fs.open(<span class="string">"/tmp/foo.txt"</span>)
            f:read(cb)
        <span class="keyword">end</span> },
        make_folder = { <span class="keyword">function</span>(cb)
            fs.make_folder(<span class="string">"/tmp/bar"</span>, cb)
        <span class="keyword">end</span> },
        write_data = { <span class="string">"get_data"</span>, <span class="string">"make_folder"</span>, <span class="keyword">function</span>(results, cb)
            <span class="keyword">local</span> data = <span class="global">table</span>.<span class="global">unpack</span>(results.get_data)
            <span class="keyword">local</span> f = fs.open(<span class="string">"/tmp/bar/foo.txt"</span>)
            f:write(data, cb)
        <span class="keyword">end</span> },
    },
    <span class="keyword">function</span>(err, results)
        <span class="keyword">if</span> err ~= <span class="keyword">nil</span> <span class="keyword">then</span>
            <span class="global">error</span>(err)
        <span class="keyword">else</span>
            <span class="global">print</span>(<span class="string">"success"</span>)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
)</pre>
                    </div>
                </div>
                <div id="do_while" class="box section__item">
                    <div class="block section__item__title">
                        <strong>do_while(iteratee, test, final_callback)</strong>
                        <a class="source-ref" href="source/async.lua.html#355">line 355</a>
                        <span class="tag">async</span>
                    </div>

                    <div class="block content section__item__description">Repeatedly calls <code>test</code> and <code>iteratee</code> until stopped. </p>

<p> <code>iteratee</code> is called repeatedly. It is passed a callback
 (<code>function(err, ...)</code>), which should be called with either an error or any
 results of the iteration.</p>

<p> <code>test</code> is called once per iteration, after <code>iteratee</code>. It is passed a
 callback (<code>function(err, stop)</code>) and any non-error values from <code>iteratee</code>.
 The callback should be called with either an error or a boolean value.
 Iteration will stop when an error is passed by either callback or when
 <code>test</code> passes a falsy value.</p>

<p> In either case <code>final_callback</code> will be called with the latest results from
 <code>iteratee</code>.</p>

<p> This is, in concept, analogous to a <code>do {} while ()</code> construct, where <code>iteratee</code>
 is the <code>do</code> block and <code>test</code> is the <code>while</code> test.</div>

                    <div class="block content section__item__params">
                        <h4 class="title is-6">Parameters:</h4>
                        <ul>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>iteratee</em></span>
                                    <span class="parameter__description">:&nbsp; Called repeatedly. Signature: <code>function(cb)</code>.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>test</em></span>
                                    <span class="parameter__description">:&nbsp; Called once per iteration, after <code>iteratee</code>.
  Signature: <code>function(..., cb)</code>.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>final_callback</em></span>
                                    <span class="parameter__description">:&nbsp; Called once, when <code>test</code> indicates to stop
  the iteration.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <div class="block content section__item__returns">
                        <h4 class="title is-6">Callback parameters:</h4>
                        <ul>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>Any error from <code>iteratee</code> or <code>test</code>.</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">any</span></span>
                                </div>
                            </li>
                            <li class="return-value">
                                <div class="return-value__description">
                                    <span>Values passed by the most recent execution of <code>iteratee</code>.</span>
                                </div>
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">any</span></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="callback" class="box section__item">
                    <div class="block section__item__title">
                        <strong>callback([object], fn, ...)</strong>
                        <a class="source-ref" href="source/async.lua.html#407">line 407</a>
                    </div>

                    <div class="block content section__item__description">Wrap a function with arguments for use as callback. </p>

<p> This may be used to wrap a function or table method as a callback, providing a (partial)
 argument list.
 Arguments to this call are passed through to the provided function when it is called,
 arguments from the final caller are appended after those.</p>

<p> If the function is actually a method (i.e. it expects a <code>self</code> parameter or is called with <code>:</code>),
 the <code>self</code> table can be passed as the first argument. Otherwise, <code>nil</code> should be passed.</div>

                    <div class="block content section__item__params">
                        <h4 class="title is-6">Parameters:</h4>
                        <ul>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>object</em></span>
                                    <span class="parameter__description">:&nbsp; The object to call the method on.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
                                        </div>
                                    </div>
                                    <div class="control">
                                        <div class="tags">
                                            <span class="tag">optional</span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>fn</em></span>
                                    <span class="parameter__description">:&nbsp; The function to wrap.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">function</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="parameter">
                                <div>
                                    <span class="parameter__name"><em>...</em></span>
                                    <span class="parameter__description">:&nbsp; Arbitrary arguments to pass through to the wrapped function.</span>
                                </div>
                                <div class="field is-grouped is-grouped-multiline parameter__tags">
                                    <div class="control">
                                        <div class="tags has-addons">
                                            <span class="tag is-dark">type</span>
                                            <span class="tag"><span class="type">any</span></span>
                                        </div>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                    <div class="block content section__item__returns">
                        <h4 class="title is-6">Returns:</h4>
                        <ul>
                            <li class="return-value">
                                <div class="tags has-addons">
                                    <span class="tag is-dark">type</span>
                                    <span class="tag return-value__type"><span class="type">function</span></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<footer class="footer">
    <div class="content has-text-centered">
        Generated by <a href="https://github/com/stevendonovan/LDoc">LDoc 1.4.6</a>, designed with <a href="https://github.com/jgthms/bulma">Bulma</a>. Last updated at 2022-03-06 19:49:25.
    </div>
</footer>

</body>
</html>
